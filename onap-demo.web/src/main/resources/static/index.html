<!DOCTYPE html>
<html>
<head>
    <title>ONAP Dashboard</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {font-family: Monospace; background-color: #ddd; margin: 0px; overflow: hidden;}
            #info {position: absolute; color: #fff; top: 0px; width: 100%; padding: 5px; text-align:center;}
            a {color: #fff;}
            #info {position: absolute; top: 10px; width: 100%; text-align: center; z-index: 100;display:block;}
        </style>
         
        <!-- script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script-->
        <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
        <!-- websocket -->
    <!-- script src="/webjars/jquery/jquery.min.js"></script-->
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
        <script>
        // for three js global access
        //var sceneExt;
        
        // Timer variables
        var timers = new Array();
        var timerStateArray = new Array();
        var timerFrame = 1;
        timerStateArray[1] = 0;
        var closedLoopCounter = 0;
        var monitoringActive = 0;
        
        function doTimer(cell,speed,htmlDOMelementId) { timedCall(cell,speed,htmlDOMelementId); }
        // Main timing loop calls itself
        function timedCall(cell,speed,htmlDOMelementId) {
        	if(cell == 1) {
        		   if(timerFrame < 1) {
        			   //document.getElementById('phases-t1').bgColor='#d0d0d0';
        		   } else {
        			   //document.getElementById('phases-t1').bgColor='#ffff40';
        		   }
        		   timerFrame = 1 - timerFrame;
        		   //refreshModelFromBackend('vfm-preload');
             } else {
            	 runCollector();
             }
        	 timers[cell] = setTimeout(function() { timedCall(cell,speed,htmlDOMelementId); }, speed); // no speed = max speed
        }
         
        function load() { 
        	doTimer(1, 2000, 2); // flashing
        	doTimer(2, 10000, 2); // sec
        	}

        function runCollector() {
        	// verify we are running
        	if (monitoringActive > 0) {
        
            //var arrowToFlash = "edge-firewall-dmaap";
        
            // change text temp
            //$( "#config-customer-value" ).html( "<strong>Running Collector ...</strong>" );
            $.ajax({url: "/api",
              //dataType: 'application/json',
            data: {
             action: 'sec'
            },
            success: function( data ) {
               var returnedData = JSON.parse(data.content);
               //console.log(returnedData);
               for(var i in returnedData) {
                    var rec = JSON.parse(returnedData[i]);
                    console.log(rec.event);   
            	   $( "#closed-loop-logs-cell" ).append(rec.event.commonEventHeader.eventId + ","//":{\"measurementsForVfScalingFields\":{\"measurementInterval\":10,\"measurementsForVfScalingVersion\":1.1,\"vNicUsageArray\":[{\"multicastPacketsIn\":0,\"bytesIn\":14500,\"unicastPacketsIn\":0,\"multicastPacketsOut\":0,\"broadcastPacketsOut\":0,\"packetsOut\":0,\"bytesOut\":0,\"broadcastPacketsIn\":0,\"packetsIn\":500,\"unicastPacketsOut\":0,\"vNicIdentifier\":\"eth1\"}]},\"commonEventHeader\":{\"reportingEntityName\":\"demofwl01fwl\",\"startEpochMicrosec\":1500656259410865,\"lastEpochMicrosec\":1500656269410865,\"eventId\":\"24170\"
            	    );
            	   $( "#closed-loop-logs").html(rec.event.commonEventHeader.eventId);//":{\"measurementsForVfScalingFields\":{\"measurementInterval\":10,\"measurementsForVfScalingVersion\":1.1,\"vNicUsageArray\":[{\"multicastPacketsIn\":0,\"bytesIn\":14500,\"unicastPacketsIn\":0,\"multicastPacketsOut\":0,\"broadcastPacketsOut\":0,\"packetsOut\":0,\"bytesOut\":0,\"broadcastPacketsIn\":0,\"packetsIn\":500,\"unicastPacketsOut\":0,\"vNicIdentifier\":\"eth1\"}]},\"commonEventHeader\":{\"reportingEntityName\":\"demofwl01fwl\",\"startEpochMicrosec\":1500656259410865,\"lastEpochMicrosec\":1500656269410865,\"eventId\":\"24170\"
                    
            	   //refreshModelFromBackend('vfm-preload');
            	   if(closedLoopCounter < 1) {
            		   document.getElementById('phases-t6').bgColor='#ff0050';
                       //sceneExt.getObjectByName(arrowToFlash).line.material.color.set(0xff0060);
                       //sceneExt.getObjectByName(arrowToFlash).cone.material.color.set(0xff0060);
                       scene.getObjectByName( "generator", true ).material.color.set(0xff0050);
            	   } else {
            		   document.getElementById('phases-t6').bgColor='#d0d0d0';
                       //sceneExt.getObjectByName(arrowToFlash).line.material.color.set(0xc0ff40);
                       //sceneExt.getObjectByName(arrowToFlash).cone.material.color.set(0xc0ff40); 
            		   scene.getObjectByName( "generator", true ).material.color.set(0xd0d0d0);
            		   
            	   }
            	   closedLoopCounter = 1 - closedLoopCounter;
               }
                }}); 
            }
        }
  
        function modifyInputs() {
        	
        }
        function runMonitoring() {
        	var lState = "OFF";
        	
        	monitoringActive = 1 - monitoringActive;
        	if(monitoringActive > 0) {
        		lState = "ON";
                document.getElementById('monitor-button').bgColor='#0fff30';
        	} else {
                document.getElementById('monitor-button').bgColor='#cf0f50';
        	}
        	document.getElementById('run-monitoring-button').value = lState;
        	// check inputs
        	var network = document.getElementById('onap-network').value;
        	console.log(network);
        	$( "#config-vfmodule-value" ).html(network);
        }
        
        function runInitConfig(source) {
        	console.log(source);
                $( "#init-config-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t1').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'init-config'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t1').bgColor='#c0ff30'
                   $( "#init-config-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }
  
        function runServiceDeployRead(source) {
            console.log(source);
                $( "#service-deploy-read-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t2a').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'service-deploy-read'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t2a').bgColor='#c0ff30'
                   $( "#service-deploy-read-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }

        function runServiceCreationRead(source) {
            console.log(source);
                $( "#service-creation-read-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t2b').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'service-creation-read'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t2b').bgColor='#c0ff30'
                   $( "#service-creation-read-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }

        function runVnfCreationRead(source) {
            console.log(source);
                $( "#vnf-creation-read-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t3').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'vnf-creation-read'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t3').bgColor='#c0ff30'
                   $( "#vnf-creation-read-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }
        
        function runVfmPreload(source) {
            console.log(source);
                $( "#vfm-preload-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t4').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'vfm-preload'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t4').bgColor='#c0ff30'
                   $( "#vfm-preload-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }

        function runVfmCreationRead(source) {
            console.log(source);
                $( "#vfm-creation-read-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t5').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'vfm-creation-read'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t5').bgColor='#c0ff30'
                   $( "#vfm-creation-read-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }

        function runClosedLoop(source) {
            console.log(source);
                $( "#closed-loop-logs" ).html( "<strong>Running ...</strong>" );
                document.getElementById('phases-t6').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'closed-loop'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t6').bgColor='#c0ff30'
                   $( "#closed-loop-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }

        /*function runButton(source) {
            console.log(source);
                $( "#vfm-preload-logs" ).html( "<strong>VFM Preload ...</strong>" );
                document.getElementById('phases-t4').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'vfm-preload'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t4').bgColor='#c0ff30'
                   $( "#vfm-preload-logs" ).html( "<strong>" + returnedData + "</strong>" );
                }}); 
        }*/

        function refreshModelFromBackend(source) {//}, aScene, _threejsFlashStates) {
            var arrowToFlash = "edge-firewall-dmaap";
            var sourceVM = "dmaap";
            var targetVM = "firewall";
            var flashOnColor = 0xcf0060;
            var flashOffColor = 0xc0cf40;
       
             	//console.log("scene: " + scene);
                $( "#vfm-preload-logs" ).html( "<strong>VFM Preload ...</strong>" );
                document.getElementById('phases-t4').bgColor='#ffff40'
                $.ajax({url: "/api",
                  //dataType: 'application/json',
                data: {
                  action: 'vfm-preload'
                },
                success: function( data ) {
                   var returnedData = data;//JSON.parse(data.content);
                   console.log(returnedData);
                   document.getElementById('phases-t4').bgColor='#c0ff30'
                   // flash cubes
                   var aFirewall = scene.getObjectByName( targetVM, true );
                   var aDmaap = scene.getObjectByName( sourceVM , true );
                   if(threejsFlashStates[sourceVM ] < 1) {
                	    scene.getObjectByName(arrowToFlash).line.material.color.set(flashOnColor);
                	    scene.getObjectByName(arrowToFlash).cone.material.color.set(flashOnColor);
                	    aDmaap.material.color.set(flashOnColor);
                	    aFirewall.material.color.set(flashOnColor);
                   } else {
                	   scene.getObjectByName(arrowToFlash).line.material.color.set(flashOffColor);
                	   scene.getObjectByName(arrowToFlash).cone.material.color.set(flashOffColor);
                	   aDmaap.material.color.set(flashOffColor);
                	   aFirewall.material.color.set(flashOffColor);
                   }
                   threejsFlashStates[sourceVM ] = 1 - threejsFlashStates[sourceVM ];
                   
                   
                   $( "#vfm-preload-logs" ).html( "<strong>" + returnedData + "</strong>" );
                    }}); 
        }
        /*var stompClient = null;

        function setConnected(connected) {
            $("#connect").prop("disabled", connected);
            $("#disconnect").prop("disabled", !connected);
            if (connected) {
                $("#conversation").show();
            }
            else {
                $("#conversation").hide();
            }
            $("#greetings").html("");
        }

        function connect() {
            var socket = new SockJS('/gs-guide-websocket');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                setConnected(true);
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/greetings', function (greeting) {
                    showGreeting(JSON.parse(greeting.body).content);
                });
            });
        }

        function disconnect() {
            if (stompClient != null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }

        function sendName() {
            stompClient.send("/app/hello", {}, JSON.stringify({'name': $("#name").val()}));
        }

        function showGreeting(message) {
        	console.log(message);
        
            $("#config-customer-value").append("<tr><td>" + message + "</td></tr>");
        }

        $(function () {
            $("form").on('submit', function (e) {
                e.preventDefault();
            });
            $( "#connect" ).click(function() { connect(); });
            $( "#disconnect" ).click(function() { disconnect(); });
            $( "#send" ).click(function() { sendName(); });
        });*/
        // above breaking all forms

        
//        function WebSocketTest() {
//           if ("WebSocket" in window) {
//              alert("WebSocket is supported by your Browser!");
              
              // Let us open a web socket
//              var ws = new WebSocket("ws://localhost:9998/echo");
               
//              ws.onopen = function() {
                 // Web Socket is connected, send data using send()
//                 ws.send("Message to send");
//                 alert("Message is sent...");
//              };
               
//              ws.onmessage = function (evt) { 
//                 var received_msg = evt.data;
//                 alert("Message is received...");
//              };
               
//              ws.onclose = function() { 
                 // websocket is closed.
//                 alert("Connection is closed..."); 
//              };
//           } else {
              // The browser doesn't support WebSocket
//              alert("WebSocket NOT supported by your Browser!");
//           }
//        }

        </script>
</head>
<body onload="javascript:load();">
    <div id="north">
        <table><tr>
        <td><a href="http://wiki.onap.org/display/DW/Developer+Wiki"><img alt="ONAP vFirewall Demo" src="textures/sprites/logo_onap_4x.png" width="180"></a></td>
        <td style="font-weight:bold; text-align: center">&nbsp;Dashboard</td>
        </tr></table>
    </div>
    <!-- div id="info">Description</div-->
    <div id="center">
        <table id="config">
         <tr>
            <td id="config-customer-key" style="font-weight:bold; text-align: left" bgcolor="#ffff50">Customer:</td>
            <td id="config-customer-value"style="font-weight:italic; text-align: right" bgcolor="#ffff50">none</td>
            <td id="config-service-key"style="font-weight:bold; text-align: left" bgcolor="#ffff50">Service:</td>
            <td id="config-service-value"style="font-weight:italic; text-align: right" bgcolor="#ffff50">none</td>
            <td id="config-vnf-key"style="font-weight:bold; text-align: left" bgcolor="#ffff50">VNF:</td>
            <td id="config-vnf-value"style="font-weight:italic; text-align: right" bgcolor="#ffff50">none</td>
            <td id="config-vfmodule-key"style="font-weight:bold; text-align: left"bgcolor="#ffff50">VF-Module:</td>
            <td id="config-vfmodule-value"style="font-weight:italic; text-align: right">none</td>

        </tr></table>        
    </div>
    <div id="d2">d2</div>
    <div id="d3">
           <script src="https://fb.me/react-15.0.1.js"></script>
    <script src="https://fb.me/react-dom-15.0.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    
    <script src="scripts.js" type="text/babel"></script>
    
    <!--  div id="info"><a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - ConvexGeometry</div-->
    <script src="../build/three.js"></script>
    <script src="js/controls/OrbitControls.js"></script>
    <script src="js/QuickHull.js"></script>
    <script src="js/geometries/ConvexGeometry.js"></script>
    <script src="js/Detector.js"></script>
    <script src="js/libs/stats.min.js"></script>

    <script>
        if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
        var group, camera, scene;
        var renderer, frameStep, maxFrame;
        var cube1material, cube1state, texture1, texture2, aspect, gridOffset, layerOffset;
        var mouseObjects = []; // for intersections
        var count = 0;
        var colorRed = 0xff0050;
        var colorGreen = 0xc0ff30;
        var colorBlue = 0x20c0ff;
        var colorYellow = 0xffff40;
        var threejsFlashStates = {};

        maxFrame = 100; 
        frameStep = 30;
        aspect = 2;
        gridOffset = 0.75;
        layerOffset = gridOffset * 5;
        cube1state = 1;
        init();
        animate();
            
        function init() {
            scene = new THREE.Scene();
            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            //renderer.setSize( window.innerWidth / (3/2), window.innerHeight / ((3/2) * aspect) );
            renderer.setSize( window.innerWidth, window.innerHeight / aspect );
            renderer.setClearColor(0xe0e0e0, 1); // bg
            document.body.appendChild( renderer.domElement );

            // https://threejs.org/docs/#api/cameras/PerspectiveCamera
            camera = new THREE.PerspectiveCamera( 20, window.innerWidth / window.innerHeight * aspect, 1, 2000 );
            camera.position.set( 35, 30, 40 );
            scene.add( camera );

            // controls
            var controls = new THREE.OrbitControls( camera, renderer.domElement );
            controls.minDistance = 20;
            controls.maxDistance = 50;
            controls.maxPolarAngle = Math.PI / 2;
            //controls.enablePan = true;

            scene.add( new THREE.AmbientLight( 0x111111 ) );

            // light
            var light = new THREE.PointLight( 0xffffff, 1 );
            camera.add( light );
            //scene.add( new THREE.AxisHelper( 20 ) );

            // textures
            var loader = new THREE.TextureLoader();
            var texture = loader.load( 'textures/sprites/disc.png' );

            group = new THREE.Group();
            scene.add( group );

            // service
            var cubeGeo = new THREE.CylinderGeometry(1*gridOffset, 1*gridOffset, 0.5*gridOffset, 64);
            texture1 = loader.load('textures/sprites/logo_onap_4x.png')
            texture2 = loader.load('textures/sprites/logo_onap_4xtint.png')
            var meshMaterial = new THREE.MeshLambertMaterial( { color: 0xfffffff, opacity: 0.9, transparent: false} );
            cube1material = meshMaterial;
            var meshGeometry = new THREE.ConvexBufferGeometry(cubeGeo.vertices );
            var mesh = new THREE.Mesh( meshGeometry, meshMaterial);//.clone() );
            mesh.material.side = THREE.FrontSide; // front faces
            mesh.renderOrder = 1;
            mesh.position.y = (gridOffset / 4) + layerOffset;
            mesh.name = "service-firewall";
            group.add( mesh );
            mouseObjects.push(mesh); 
                
                
            // VMs
            var meshVM;
            var vmGeo;
            var meshMaterialVM;
            var meshGeometryVM;
            var vmNames = ["generator", "firewall", "sink"];
            var vmSize = 1;
            for(var vm=0; vm<3; vm++){

                threejsFlashStates[vmNames[vm]] = 0;
                vmGeo = new THREE.BoxGeometry( 1*gridOffset,0.5*gridOffset,1*gridOffset);
                meshMaterialVM = new THREE.MeshLambertMaterial( { color: 0xdfdfff, opacity: 0.9, transparent: false} );
                meshGeometryVM = new THREE.ConvexBufferGeometry(vmGeo.vertices );
                meshVM = new THREE.Mesh( meshGeometryVM, meshMaterialVM);//.clone() );
                meshVM.material.side = THREE.FrontSide; // front faces
                meshVM.renderOrder = 1;
                meshVM.position.y = (gridOffset / 4) * vmSize;
                meshVM.position.x = gridOffset + (((vm - 1) * gridOffset) * 6) - gridOffset;
                //meshVM.userData.id = "vm" + vm;
                meshVM.name = vmNames[vm];
                group.add( meshVM );
                mouseObjects.push(meshVM);
            }
            
            
            // ONAP VMs
            //var meshVM;
            //var vmGeo;
            //var meshMaterialVM;
            //var meshGeometryVM;
            vmNames = ["appc", "policy", "dmaap"];
            //var vmSize = 1;
            for(var vm=0; vm<3; vm++){
            	threejsFlashStates[vmNames[vm]] = 0;
            	vmGeo = new THREE.BoxGeometry( 1*gridOffset,0.5*gridOffset,1*gridOffset);
                meshMaterialVM = new THREE.MeshLambertMaterial( { color: 0xdfdfff, opacity: 0.9, transparent: false} );
                meshGeometryVM = new THREE.ConvexBufferGeometry(vmGeo.vertices );
                meshVM = new THREE.Mesh( meshGeometryVM, meshMaterialVM);
                meshVM.material.side = THREE.FrontSide; // front faces
                meshVM.renderOrder = 1;
                meshVM.position.y = (gridOffset / 4) * vmSize - layerOffset;
                meshVM.position.x = gridOffset + (((vm - 1) * gridOffset) * 6) - gridOffset;
                //meshVM.userData.id = "vm" + vm;
                meshVM.name = vmNames[vm];
                group.add( meshVM );
                mouseObjects.push(meshVM);
            }
                
            // edges
            // https://stackoverflow.com/questions/18286837/how-to-chain-two-geometric-objects-using-three-js
            var vmFromNames = ["generator", "firewall", "service-firewall", "firewall"];
            var vmToNames = ["firewall", "sink", "firewall", "dmaap"];
            for(var vm=0; vm<vmFromNames.length; vm++) {
            	threejsFlashStates[vmNames[vm]] = 0;
                var startObject = scene.getObjectByName(vmFromNames[vm]);
                var endObject = scene.getObjectByName(vmToNames[vm]);
                var startPoint = new THREE.Vector3(startObject.position.x, startObject.position.y, startObject.position.z);
                var endPoint   = new THREE.Vector3(endObject.position.x, endObject.position.y, endObject.position.z);
                var direction = new THREE.Vector3().subVectors(endPoint, startPoint).normalize();
                var arrow = new THREE.ArrowHelper(direction, startPoint, startPoint.distanceTo(endPoint), colorRed );
                arrow.line.material.linewidth = 4; // no effect on windows
                var vName = "edge-" + vmFromNames[vm] + "-" + vmToNames[vm];
                console.log(vName);
                arrow.name = vName;
                group.add(arrow);
            }
                
            // layers
            var oz = 15 * gridOffset;
            var oy = 0.1;
            var ox = 30 * gridOffset;
            var layerColor = 0xccccff;
            createLayer(ox, oy, oz, group, layerOffset, 0xffccff);
            createLayer(ox, oy, oz, group, 0, layerColor);
            createLayer(ox, oy, oz, group, -layerOffset, layerColor);
             
                
            var textOffsetY = -2 * gridOffset;
            var color = 0x10508f;      
            // add text
            // from https://github.com/mrdoob/three.js/blob/master/examples/webgl_geometry_text_shapes.html
            var floader = new THREE.FontLoader();
            //floader.load( 'fonts/helvetiker_regular.typeface.json', fontFunction('fonts/helvetiker_regular.typeface.json', "test", layerOffset));
            // need to consolidate!
            floader.load( 'fonts/helvetiker_regular.typeface.json', function(font) {
                var xMid, text;
                var textShape = new THREE.BufferGeometry();   
                var matDark = new THREE.LineBasicMaterial({color: color,side: THREE.DoubleSide} );
                var matLite = new THREE.MeshBasicMaterial({color: color,transparent: true,opacity: 0.4, side: THREE.DoubleSide} );
                var message = "Services";
                var shapes = font.generateShapes( message, 0.5, 0.1 );
                var geometry = new THREE.ShapeGeometry( shapes );
                geometry.computeBoundingBox();
                xMid = - 0.5 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );
                geometry.translate( xMid, 5 * gridOffset, textOffsetY);
                // make shape ( N.B. edge view not visible )
                textShape.fromGeometry( geometry );
                text = new THREE.Mesh( textShape, matLite );
                text.position.z = - layerOffset;//150;
                scene.add( text );
                // make line shape ( N.B. edge view remains visible )
                var holeShapes = [];
                for (var i = 0; i < shapes.length; i ++ ) {
                    var shape = shapes[ i ];
                    if (shape.holes && shape.holes.length > 0 ) {
                        for (var j = 0; j < shape.holes.length; j ++ ) {
                            var hole = shape.holes[ j ];
                            holeShapes.push( hole );
                        }
                    }
                }
                shapes.push.apply( shapes, holeShapes );
                var lineText = new THREE.Object3D();
                for ( var i = 0; i < shapes.length; i ++ ) {
                    var shape = shapes[ i ];
                    var lineGeometry = shape.createPointsGeometry();
                     lineGeometry.translate( xMid, 0, 0 );
                     //var lineMesh = new THREE.Line( lineGeometry, matDark );
                    //lineText.add( lineMesh );
                }
                scene.add( lineText );
            }); 
        
            floader.load( 'fonts/helvetiker_regular.typeface.json', function(font) {
                var xMid, text;
                var textShape = new THREE.BufferGeometry();
                var matDark = new THREE.LineBasicMaterial({color: color,side: THREE.DoubleSide} );
                var matLite = new THREE.MeshBasicMaterial({color: color,transparent: true,opacity: 0.4, side: THREE.DoubleSide} );
                var message = "Virtual Function Containers";
                var shapes = font.generateShapes( message, 0.5, 0.1 );
                var geometry = new THREE.ShapeGeometry( shapes );
                geometry.computeBoundingBox();
                xMid = - 0.5 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );
                geometry.translate( xMid, 0 * gridOffset, textOffsetY );
                // make shape ( N.B. edge view not visible )
                textShape.fromGeometry( geometry );
                text = new THREE.Mesh( textShape, matLite );
                text.position.z = - layerOffset;//150;
                scene.add( text );
                // make line shape ( N.B. edge view remains visible )
                var holeShapes = [];
                for ( var i = 0; i < shapes.length; i ++ ) {
                    var shape = shapes[ i ];
                    if ( shape.holes && shape.holes.length > 0 ) {
                        for ( var j = 0; j < shape.holes.length; j ++ ) {
                            var hole = shape.holes[ j ];
                            holeShapes.push( hole );
                        }
                    }
                }
                shapes.push.apply( shapes, holeShapes );
                var lineText = new THREE.Object3D();
                for ( var i = 0; i < shapes.length; i ++ ) {
                    var shape = shapes[ i ];
                    var lineGeometry = shape.createPointsGeometry();
                    lineGeometry.translate( xMid, 0, 0 );
                    //var lineMesh = new THREE.Line( lineGeometry, matDark );
                    //lineText.add( lineMesh );
                }
               scene.add( lineText );
            } ); //end load function

                
            floader.load( 'fonts/helvetiker_regular.typeface.json', function(font) {
                var xMid, text;
                var textShape = new THREE.BufferGeometry();
                var matDark = new THREE.LineBasicMaterial({color: color,side: THREE.DoubleSide} );
                var matLite = new THREE.MeshBasicMaterial({color: color,transparent: true,opacity: 0.4, side: THREE.DoubleSide} );
                var message = "ONAP Containers";
                var shapes = font.generateShapes( message, 0.5, 0.1 );
                var geometry = new THREE.ShapeGeometry( shapes );
                geometry.computeBoundingBox();
                xMid = - 0.5 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );
                geometry.translate( xMid, -5 * gridOffset, textOffsetY);
                // make shape ( N.B. edge view not visible )
                textShape.fromGeometry( geometry );
                text = new THREE.Mesh( textShape, matLite );
                text.position.z = -layerOffset;//150;
                scene.add( text );
                // make line shape ( N.B. edge view remains visible )
                var holeShapes = [];
                for ( var i = 0; i < shapes.length; i ++ ) {
                    var shape = shapes[ i ];
                    if ( shape.holes && shape.holes.length > 0 ) {
                        for ( var j = 0; j < shape.holes.length; j ++ ) {
                            var hole = shape.holes[ j ];
                            holeShapes.push( hole );
                        }
                    }
                }
                shapes.push.apply( shapes, holeShapes );
                var lineText = new THREE.Object3D();
                for ( var i = 0; i < shapes.length; i ++ ) {
                    var shape = shapes[ i ];
                    var lineGeometry = shape.createPointsGeometry();
                    lineGeometry.translate( xMid, 0, 0 );
                    //var lineMesh = new THREE.Line( lineGeometry, matDark );
                    //lineText.add( lineMesh );
                }
                scene.add( lineText );
            } ); //end load function
            window.addEventListener( 'resize', onWindowResize, false );
            sceneExt = scene;
        }

        function createLayer(_ox, _oy, _oz, group, offset, layerColor) {
            var layer2Geo = new THREE.BoxGeometry(_ox,_oy,_oz );
            var layer2Material = new THREE.MeshLambertMaterial( { color: layerColor, opacity: 0.2, transparent: true} );
            var layer2Mesh = new THREE.Mesh( layer2Geo, layer2Material);
            layer2Mesh.position.y = offset;                
            group.add(layer2Mesh);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight * aspect;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth / 2, window.innerHeight / (2 * aspect));
        }

        function animate() {
            requestAnimationFrame( animate );
            //group.rotation.y += 0.015;
            frameStep -= 1;
            render();
        }

        
        function flashState() {
            var arrowToFlash = "edge-firewall-dmaap";	
        
         	if(cube1state < 1) {
           		   //cube1material.map = texture1;
           		   //cube1material.opacity = 1.0;
            	 //  cube1material.color.set(0xff0060);
                   //document.getElementById('phases-t4').bgColor='#ff0050';
                   //document.getElementById('phases-t5').bgColor='#ff0050';
            	   //document.getElementById('phases-t6').bgColor='#ff0050';
            	   //scene.getObjectByName(arrowToFlash).line.material.color.set(0xff0060);
           		   //scene.getObjectByName(arrowToFlash).cone.material.color.set(0xff0060);
           	   } else {
           		   //console.log("flash");
           		   //cube1material.opacity = 0.1;   
                   //cube1material.color.set(0xb0ff04);
                 //  cube1material.color.set(0xc0ff40);
                   //document.getElementById('phases-t4').bgColor='#d0d0d0';
                   //document.getElementById('phases-t5').bgColor='#d0d0d0';
                   //document.getElementById('phases-t6').bgColor='#d0d0d0';
                   //scene.getObjectByName(arrowToFlash).line.material.color.set(0xc0ff40);
                   //scene.getObjectByName(arrowToFlash).cone.material.color.set(0xc0ff40);
                } 
                cube1state = 1 - cube1state;
                //refreshModelFromBackend('vfm-preload');//, scene, threejsFlashStates);
        }
            
        function render() {
           	if(frameStep < 1) {
            	//console.log("test " + frameStep);
            	frameStep = maxFrame;
            	flashState();
            } else {
            	//console.log("frame: " + frameStep);
            }
            renderer.render( scene, camera );
        }
            
        // find intersections
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();

        // mouse listener
        document.addEventListener( 'mousedown', function( event ) {    
            var rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ( ( event.clientX - rect.left ) / ( rect.width - rect.left ) ) * 2 - 1;
            mouse.y = - ( ( event.clientY - rect.top ) / ( rect.bottom - rect.top) ) * 2 + 1;
                raycaster.setFromCamera( mouse, camera );
                intersects = raycaster.intersectObjects( mouseObjects );
                if ( intersects.length > 0 ) {         
                    document.getElementById('center').innerHTML = 'INTERSECT Count: ' + ++count + intersects[0].point;
                    //intersects[0].face.color.setRGB( 0.8 * Math.random() + 0.2, 0, 0 );
                }
            }, false );    

        </script>
        </div>
        <div id="south">
        <table id="log_phases">
            <tr><td>
    <table id="phases">
        <tr><td id="phases-t0" style="font-weight:bold; text-align: center">Demo Phase:</td><tr>
            <td id="phases-t1" bgcolor="#ffff50">Initial Config</td>
            <td><form action="javascript:runInitConfig('init-config');" method="get"><input type="submit" value="Run"></input></form></td>
            <td id="init-config-logs">logs</td>
        </tr><tr>
            <td id="phases-t2a" bgcolor="#20c0ff">Service Deploy (read)</td>
            <td><form action="javascript:runServiceDeployRead('service-deploy-read');" method="get"><input type="submit" value="Verify"></input></form></td>
            <td id="service-deploy-read-logs">logs</td>
        </tr><tr>
            <td id="phases-t2b" bgcolor="#20c0ff">Service Creation (read)</td>
            <td><form action="javascript:runServiceCreationRead('service-creation-read');" method="get"><input type="submit" value="Verify"></input></form></td>
            <td id="service-creation-read-logs">logs</td>
        </tr><tr>
            <td id="phases-t3" bgcolor="#c0ff30">VNF Creation (read)</td>
            <td><form action="javascript:runVnfCreationRead('vnf-creation-read');" method="get"><input type="submit" value="Verify"></input></form></td>
            <td id="vnf-creation-read-logs">logs</td>
        </tr><tr>
            <td id="phases-t4" bgcolor="#ff0050">VF Module Preload</td>
            <td><form action="javascript:runVfmPreload('vfm-preload');" method="get"><input type="submit" value="Run"></input></form></td>
            <td id="vfm-preload-logs">logs</td>
        </tr><tr>
            <td id="phases-t5" bgcolor="#ff0050">VF Module Creation (read)</td>
            <td><form action="javascript:runVfmCreationRead('vfm-creation-read');" method="get"><input type="submit" value="Verify"></input></form></td>
            <td id="vfm-creation-read-logs">logs</td>
        </tr><tr>
            <td id="phases-t6" bgcolor="#c0ff30">Start Closed Loop</td>
            <td><form action="javascript:runClosedLoop('closed-loop');" method="get"><input type="submit" value="Run"></input></form></td>
            <td id="closed-loop-logs">logs</td>
        </tr><tr>
            <td id="monitor-button" bgcolor="#ff0050">Monitoring</td>
            <td><form action="javascript:runMonitoring();" method="get"><input id="run-monitoring-button" type="submit" value="OFF"></input></form></td>
            <td id="monitoring-logs">logs</td>
        </tr></table>
        </td>
        <td id="phase-logs" bgcolor="#cfcf50">
        logs
        </td></tr></table>
        <table id="closed-loop-logs-table">
        <tr><td id="closed-loop-logs-cell" bgcolor="#cfcf70">Closed Loop: 
        
        </td></tr></table>        
        </div>
        <div id="inputs">
            <table><tr>
            <td><form action="javascript:modifyInputs();" method="get">ONAP Network: <input id="onap-network" type="text" name="onap-network"></input><br/></form></td>
            </tr>
            </table>
        </div>
</body>
</html>
